<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card-hover { transition: all .3s ease }
    .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,.15) }
    /* small green outline used when a crop or stage is active */
    .outline-green {
      box-shadow: 0 0 0 3px rgba(16,185,129,0.08), 0 0 0 1px rgba(16,185,129,0.6) inset;
      border-radius: 12px;
      border: 1px solid rgba(16,185,129,0.25);
    }
    /* smooth collapse transition */
    .collapsible {
      overflow: hidden;
      transition: max-height .28s ease, padding .28s ease;
    }
  </style>
  <link rel="icon" href="../favicon.ico" />
  <title>AgriSense ‚Äî Crop Calendar</title>
</head>
<body class="bg-gray-50 font-sans">
  <!-- Offline Banner -->
  <div class="bg-green-600 text-white text-center py-2 text-sm">üåê Works Partially Offline in Low Connectivity Regions</div>
  <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center"><span
              class="text-2xl">üå±</span></div>
          <div>
            <h1 class="text-xl font-bold text-gray-800" data-translate="site-name">AgriSense</h1>
            <p class="text-xs text-gray-600" data-translate="site-tagline">AI Crop Recommendation System</p>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <select id="languageSelect" class="px-3 py-1 border border-gray-300 rounded-md text-sm bg-white">
            <option value="en">English</option>
            <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
            <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
          </select>
          <button id="mobileMenuBtn" class="md:hidden p-2"><span class="text-2xl">‚ò∞</span></button>
        </div>
      </div>
      <nav class="hidden md:block mt-4">
        <ul class="flex flex-wrap space-x-6 text-sm font-medium">
          <li><a href="index.html" class="hover:text-green-600 transition-colors" data-translate="nav-home">Home</a></li>
          <li><a href="crop-recommendation.html" class="hover:text-green-600 transition-colors" data-translate="nav-crop">Crop Recommendation</a></li>
          <li><a href="pest-detection.html" class="hover:text-green-600 transition-colors" data-translate="nav-pest">Pest Detection</a></li>
          <li><a href="soil-testing.html" class="hover:text-green-600 transition-colors" data-translate="nav-soil">Soil Testing</a></li>
          <li><a href="dashboard.html" class="hover:text-green-600 transition-colors" data-translate="nav-dashboard">Dashboard</a></li>
          <li><a href="community.html" class="hover:text-green-600 transition-colors" data-translate="nav-community">Community</a></li>
          <li><a href="about.html" class="hover:text-green-600 transition-colors" data-translate="nav-about">About</a></li>
        </ul>
      </nav>
      <!-- Mobile Nav -->
      <nav id="mobileNav" class="hidden md:hidden mt-4 border-t pt-4">
        <ul class="space-y-2">
          <li><a href="index.html" class="block py-2 hover:bg-gray-50 rounded px-2">Home</a></li>
          <li><a href="crop-recommendation.html" class="block py-2 hover:bg-gray-50 rounded px-2">Crop Recommendation</a></li>
          <li><a href="pest-detection.html" class="block py-2 hover:bg-gray-50 rounded px-2">Pest Detection</a></li>
          <li><a href="soil-testing.html" class="block py-2 hover:bg-gray-50 rounded px-2">Soil Testing</a></li>
          <li><a href="dashboard.html" class="block py-2 hover:bg-gray-50 rounded px-2">Dashboard</a></li>
          <li><a href="community.html" class="block py-2 hover:bg-gray-50 rounded px-2">Community</a></li>
          <li><a href="about.html" class="block py-2 hover:bg-gray-50 rounded px-2">About</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- ===== MAIN (keeps your theme) ===== -->
  <main>
    <!-- Crop Calendar Section (updated / extended) -->
    <section id="crop-calendar" class="page-section bg-gray-50 py-16">
      <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-center mb-12" data-translate="crop-calendar-title">Crop Calendar</h2>

        <!-- TOP ROW: dropdown + summary card -->
        <div class="grid lg:grid-cols-3 gap-8 mb-8">
          <div class="lg:col-span-3">
            <div class="bg-white rounded-xl p-6 shadow-lg">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                  <h3 class="text-lg font-semibold">Crop Recommendation</h3>
                  <p class="text-sm text-gray-500">Select a crop to view its calendar</p>
                </div>

                <!-- crop select (filters to only that crop) -->
                <div class="flex items-center gap-3">
                  <label for="cropSelect" class="sr-only">Select crop</label>
                  <select id="cropSelect" class="px-4 py-2 border rounded-md text-sm">
                    <!-- options injected by JS -->
                  </select>
                  <button id="showAllBtn" class="px-4 py-2 bg-gray-100 text-gray-800 rounded-md border">Show all</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Accordion grid (cards for crops) -->
        <div id="accordionRoot" class="grid lg:grid-cols-1 gap-6">
          <!-- crop cards will be injected here by JS -->
        </div>
      </div>
    </section>
  </main>

  <script>
    // --- Full CROPS data (rice, wheat, tomato, potato, corn, onion, brinjal, chili, carrot) ---
    const CROPS = [
      {
        id: 'rice',
        name: 'Rice',
        stages: [
          {
            id: 'rice_pre_sowing',
            title: 'Pre-sowing / Land Preparation',
            badge: 'Events 1',
            summary: '~ 1‚Äì2 weeks before sowing\nCondition: Field empty (previous crop removed) or fallow; bunds intact; water inlets/outlets ready',
            events: [
              'Drain/clean field: remove crop residues, weeds, repair bunds/inlets.',
              'Primary tillage: plough 2‚Äì3 passes to depth ~10‚Äì15 cm.',
              'Secondary tillage/leveling (or puddling if wet irrigation): smooth soil, ensure uniform field surface.',
              'Soil test: check pH, N/P/K/Zn; apply lime if low pH; incorporate FYM/compost/green manure.',
              'Spread/incorporate organic matter (FYM/compost) before sowing/transplanting.',
              'Set up water management: ensure irrigation system works, bunds watertight, field level correct for later uniform water depth.'
            ]
          },
          {
            id: 'rice_nursery',
            title: 'Nursery / Seedling Stage',
            badge: 'Events 2',
            summary: '~ from sowing in nursery to transplanting (if using transplanting method)\nCondition: Nursery bed: well-prepared, weed-free, good drainage; seedlings active',
            events: [
              'Prepare nursery bed: level, remove weeds.',
              'Seed selection: choose high-yielding variety, check germination, treat seeds (fungicide/insecticide) as needed.',
              'Sow seeds in nursery at recommended rate; maintain moisture by light irrigation/ponding.',
              'Nursery maintenance for ~20-30 days (depending variety): keep healthy seedlings.',
              'Hardening: a few days before transplanting reduce water in nursery slightly so seedlings become tougher.'
            ]
          },
          {
            id: 'rice_sowing',
            title: 'Sowing / Transplanting or Direct Seeding',
            badge: 'Events 3',
            summary: 'Sowing/transplanting window (e.g., specific to region/monsoon)\nCondition: Either transplanted seedlings (~25‚Äì30 days old) or direct-seeded field; soil puddled/leveled (for DSR)',
            events: [
              'Transplanting route: When seedlings reach ~25-30 days (or variety-specific). Transplant seedlings at spacing (e.g., rows 20‚Äì25 cm, plants 15‚Äì20 cm apart). Place seedlings at similar depth; after transplanting maintain ~5 cm ponded water once seedlings are established.',
              'Direct Seeding route (DSR): Puddle and level soil; broadcast or drill seeds; lightly cover. First irrigation: after sowing/transplanting ensure adequate water level, maintain field moisture/water depth.'
            ]
          },
          {
            id: 'rice_vegetative',
            title: 'Vegetative Growth Stage',
            badge: 'Events 4',
            summary: 'Early weeks after sowing/transplanting until tillering/panicle initiation\nCondition: Plants are in vegetative growth: leaves emerging, tillers starting; water maintained',
            events: [
              'Water management: if flooded system, maintain ~5-8 cm water depth (or as recommended); in low-water systems ensure soil moisture adequate.',
              'Fertiliser application: first N dose ~10-15 days after transplanting; apply P & K according to soil test.',
              'Weed control: 2‚Äì3 weeks after transplanting weed to reduce competition.',
              'Pest/disease scouting: check for stem borers, leafhoppers, nutrient deficiency (yellowing, stunted growth).',
              'Ensure field level/uniform water: refill water if depth lost; maintain bunds; check for water leaks or uneven water.'
            ]
          },
          {
            id: 'rice_tillering',
            title: 'Tillering & Panicle Initiation Stage',
            badge: 'Events 5',
            summary: 'From tiller initiation to panicle initiation\nCondition: Field has multiple tillers, plants growing stronger; panicle primordium beginning',
            events: [
              'Apply second or split doses of nitrogen and possibly micronutrients (at panicle initiation).',
              'Continue weed monitoring & control: ensure tillers develop healthily.',
              'Pest & disease control: intensive monitoring now (brown plant-hopper, sheath blight, blast etc).',
              'Water management: ensure sustained water depth; avoid abrupt drying that may hamper tiller formation or panicle initiation.',
              'Field aeration if system allows (shallow water) but ensure plants not stressed.',
              'Mark critical water requirement around panicle initiation & upcoming flowering.'
            ]
          },
          {
            id: 'rice_flowering',
            title: 'Flowering / Grain-Filling Stage',
            badge: 'Events 6',
            summary: 'From heading/flowering through grain fill until nearing maturity\nCondition: Panicles emerging/flowering; grains forming; water still important',
            events: [
              'Maintain water depth appropriately (often ~3-5 cm) until grain filling complete, then gradually reduce.',
              'Apply foliar nutrients if recommended (e.g., Zn, S) to boost grain quality & weight.',
              'Pest/disease monitoring intensifies: ear-head insect pests, grain filling diseases (grain rot etc).',
              'Avoid drought stress: even short dry spells during flowering reduce yield.',
              'Keep field free from weeds (they harbour pests).'
            ]
          },
          {
            id: 'rice_maturation',
            title: 'Maturation & Harvesting',
            badge: 'Events 7',
            summary: 'From grain-fill completion through ripening to harvest window\nCondition: Grains maturing (colour change, hardening), field water drained or reduced',
            events: [
              'Lower or stop irrigation ~5‚Äì7 days before anticipated harvest so field dries slightly for easier harvesting.',
              'Monitor crop maturity: look for golden-brown grains, hardening, moisture ~20-24% (depending variety).',
              'Determine harvest window: when ~80-90% grains turned colour & hard; avoid over-mature (shattering, lodging risk).',
              'Harvest method: manual (sickle) or mechanical (combine) depending on scale/resources.',
              'Threshing: remove grains from panicles; aim for minimal loss. Immediately after harvest: spread on mats or tarpaulins for initial sun drying.'
            ]
          },
          {
            id: 'rice_post_harvest',
            title: 'Post-harvest & Storage',
            badge: 'Events 8',
            summary: 'After harvest through drying, cleaning, storage\nCondition: Grains harvested, need safe handling & storage',
            events: [
              'Drying: reduce grain moisture to safe storage level (often ~12-14%) via sun drying or mechanical dryers.',
              'Cleaning: remove foreign matter, broken grains, stones.',
              'Storage: store in cool, dry, ventilated space; protect from rodents, insects, mould.',
              'Transport/marketing plan: bagging, logistics to mill/market.',
              'Field residue management: incorporate straw or use for fodder; clean/re-prepare bunds/ponds for next crop.'
            ]
          }
        ]
      },

      {
        id: 'wheat',
        name: 'Wheat',
        stages: [
          {
            id: 'wheat_pre_sowing',
            title: 'Pre-sowing / Land Preparation',
            badge: 'Events 1',
            summary: '~ Late Sep to early Oct (before sowing)\nCondition: Land after previous crop, allowed to dry; bunds/outlets in place; residue management needed',
            events: [
              'Remove previous crop residues, weeds, repair bunds/field boundaries.',
              'Primary tillage: plough 2‚Äì3 passes (depth ~10-15 cm) to loosen soil.',
              'Secondary tillage/leveling: harrow/puddle (if irrigated) so seedbed is fine and uniform.',
              'Soil test: check pH, N/P/K, micronutrients; apply lime, FYM/compost, green manures as needed.',
              'Spread/incorporate organic matter (FYM/compost) before sowing.',
              'Set up irrigation/drainage: ensure irrigation facility ready, bunds watertight, field level uniform.'
            ]
          },
          {
            id: 'wheat_sowing',
            title: 'Sowing / Seedling Stage',
            badge: 'Events 2',
            summary: '~ Mid-Oct to late Nov (depending on region & variety)\nCondition: Field is prepared, ready for sowing; soil moisture adequate; seeds ready',
            events: [
              'Select good variety seeds, treat seeds (fungicide/insecticide) if needed.',
              'Sowing: Using seed drill or appropriate method; seed rate as per variety; adjust for late sowing if applicable.',
              'Ensure good seed-soil contact, even sowing depth, adequate moisture.',
              'Immediately after sowing: light irrigation if required to ensure germination.',
              'Emergence & early growth: monitor seedling health, uniform stand.'
            ]
          },
          {
            id: 'wheat_vegetative',
            title: 'Vegetative Growth / Tillering Stage',
            badge: 'Events 3',
            summary: '~ Sowing to ~30-45 days after sowing\nCondition: Plants in active vegetative growth, tillers starting; water & nutrient demand increasing',
            events: [
              'Water management: Maintain soil moisture; irrigate as needed (in Rabi season irrigation likely).',
              'Nutrient application: Basal fertilizers (e.g., P & K) applied at or soon after sowing; early Nitrogen application at tillering.',
              'Weed control: Clear weeds early so young plants have minimal competition.',
              'Pest/disease scouting: Monitor for seedling pests, root issues, leaf diseases.'
            ]
          },
          {
            id: 'wheat_jointing',
            title: 'Stem Elongation / Jointing & Booting Stage',
            badge: 'Events 4',
            summary: '~ 30-60 days after sowing\nCondition: Plants are taller, nodes visible, stems elongating; reproductive development beginning',
            events: [
              'Water management: Ensure no water stress; good soil moisture to support elongation.',
              'Nitrogen split: Apply further N as plant height increases and nodes form.',
              'Micronutrients as needed (e.g., zinc, sulphur) if deficient.',
              'Pest & disease control: Monitor for rusts, blight, aphids, etc.'
            ]
          },
          {
            id: 'wheat_heading',
            title: 'Heading / Flowering / Grain Filling',
            badge: 'Events 5',
            summary: '~ 60-90 days after sowing\nCondition: Heads visible or emerging, flowers open, grain setting in process, high nutrient & water demand',
            events: [
              'Maintain adequate moisture/irrigation (critical); avoid drought or heat stress.',
              'Foliar nutrients if required (e.g., zinc, boron) to boost grain set & weight.',
              'Pest/disease monitoring intensifies: head blast, rust, ergot, etc.'
            ]
          },
          {
            id: 'wheat_maturation',
            title: 'Maturation & Harvesting',
            badge: 'Events 6',
            summary: '~ 90-120+ days after sowing\nCondition: Grain has filled, plant begins to mature (yellowing, drying); moisture content falling',
            events: [
              'Reduce irrigation/stop when appropriate to let field dry and ease harvest.',
              'Monitor maturity by grain colour/hardness, moisture content (target safe harvest level).',
              'Harvest at optimal time: when moisture is safe and before lodging/shattering risk increases.',
              'Threshing: remove grain carefully, minimise losses.'
            ]
          },
          {
            id: 'wheat_post_harvest',
            title: 'Post-harvest & Storage',
            badge: 'Events 7',
            summary: 'After harvest through drying, cleaning & storage\nCondition: Grains harvested, need safe handling',
            events: [
              'Drying: reduce grain moisture to safe storage level (e.g., ~12-14%).',
              'Cleaning: remove foreign material, broken grains, stones.',
              'Storage: store in cool, dry, ventilated conditions; protect from rodents, insects, mould.',
              'Transport/marketing: bagging, logistics to mill or market.'
            ]
          }
        ]
      },

      {
        id: 'tomato',
        name: 'Tomato',
        stages: [
          {
            id: 'tomato_pre_sowing',
            title: 'Pre-sowing / Land Preparation',
            badge: 'Events 1',
            summary: '~1‚Äì2 weeks before sowing\nCondition: Land cleared of previous crop, leveled, soil tested',
            events: [
              'Remove previous crop residues and weeds.',
              'Plough or till the soil 2‚Äì3 times to loosen and aerate.',
              'Level the field to ensure uniform irrigation.',
              'Conduct soil test: check pH, N/P/K, micronutrients; apply compost, FYM, or lime as needed.',
              'Prepare irrigation setup: ensure water supply and drainage are ready.'
            ]
          },
          {
            id: 'tomato_nursery',
            title: 'Seed Sowing / Nursery Stage',
            badge: 'Events 2',
            summary: 'Day 0‚Äì20\nCondition: Seeds germinating in trays/pots/nursery bed; soil moist, warm',
            events: [
              'Select healthy seeds of high-yielding variety.',
              'Treat seeds with fungicide/insecticide if necessary.',
              'Sow seeds in trays/pots or nursery beds at recommended density.',
              'Maintain soil moisture by gentle irrigation; avoid waterlogging.',
              'Provide shading or partial protection if light or temperature is extreme.',
              'Harden seedlings 3‚Äì5 days before transplanting by reducing water slightly.'
            ]
          },
          {
            id: 'tomato_transplant',
            title: 'Transplanting / Establishment',
            badge: 'Events 3',
            summary: 'Day 21‚Äì28\nCondition: Seedlings 4‚Äì6 true leaves, field prepared and leveled',
            events: [
              'Transplant seedlings at recommended spacing (e.g., 50 cm between rows, 30 cm between plants).',
              'Water immediately after transplanting to settle soil around roots.',
              'Mulch around plants to retain moisture and control weeds.',
              'Apply starter solution or basal fertilizer as per soil test.'
            ]
          },
          {
            id: 'tomato_vegetative',
            title: 'Vegetative Growth / Early Stage',
            badge: 'Events 4',
            summary: 'Day 29‚Äì45\nCondition: Plants actively growing, multiple leaves, initial branching',
            events: [
              'Maintain irrigation to keep soil consistently moist.',
              'Apply first N fertilizer split if not applied at transplanting.',
              'Weed regularly to reduce competition.',
              'Install support stakes or trellises if necessary.',
              'Monitor for pests (aphids, whiteflies) and early disease symptoms.'
            ]
          },
          {
            id: 'tomato_flowering',
            title: 'Flowering Initiation',
            badge: 'Events 5',
            summary: 'Day 46‚Äì60\nCondition: Flower buds forming, plants healthy, supported',
            events: [
              'Ensure adequate water and nutrient supply (balanced NPK).',
              'Apply micronutrients like calcium or magnesium if deficiency noticed.',
              'Support plants with staking/ties for proper growth.',
              'Scout for pests and diseases; apply control measures as needed.'
            ]
          },
          {
            id: 'tomato_fruit_dev',
            title: 'Fruit Development / Growth Stage',
            badge: 'Events 6',
            summary: 'Day 61‚Äì90\nCondition: Flowers pollinated, small fruits developing, soil moist',
            events: [
              'Irrigate regularly; avoid water stress during fruit set.',
              'Apply potassium-rich fertilizer to support fruit growth.',
              'Mulch to conserve moisture and suppress weeds.',
              'Continue pest/disease scouting (fruit borer, blight).'
            ]
          },
          {
            id: 'tomato_maturation',
            title: 'Maturation / Pre-Harvest Stage',
            badge: 'Events 7',
            summary: 'Day 91‚Äì110\nCondition: Fruits enlarging, colour starting to develop',
            events: [
              'Continue irrigation and nutrient application carefully to avoid excess vegetative growth.',
              'Monitor fruits for ripening stage; prevent cracking.',
              'Protect fruits from pests and diseases.'
            ]
          },
          {
            id: 'tomato_harvest',
            title: 'Harvesting',
            badge: 'Events 8',
            summary: 'Day 111‚Äì130\nCondition: Fruits fully colored and mature, plants healthy',
            events: [
              'Harvest fruits at the correct maturity for market or processing.',
              'Handle carefully to reduce bruising.',
              'Harvest in intervals if all fruits do not mature simultaneously.'
            ]
          },
          {
            id: 'tomato_post',
            title: 'Post-Harvest / Storage',
            badge: 'Events 9',
            summary: 'Immediately after harvest\nCondition: Fruits collected, clean, and sorted',
            events: [
              'Sort fruits based on size and quality.',
              'Dry or store under appropriate conditions (cool, ventilated).',
              'Transport or sell promptly to reduce losses.',
              'Clear the field of residues; compost or remove for next crop.'
            ]
          }
        ]
      },

      {
        id: 'potato',
        name: 'Potato',
        stages: [
          {
            id: 'potato_pre',
            title: 'Pre-sowing / Land Preparation',
            badge: 'Events 1',
            summary: '~1‚Äì2 weeks before planting\nCondition: Field cleared of previous crop, leveled, soil fertile and tested',
            events: [
              'Remove previous crop residues and weeds.',
              'Plough 2‚Äì3 times to loosen soil and improve aeration.',
              'Level the field for uniform irrigation and tuber development.',
              'Conduct soil test: check pH, N/P/K, micronutrients; apply compost, FYM, or lime as needed.',
              'Ensure irrigation and drainage system is ready.'
            ]
          },
          {
            id: 'potato_seed',
            title: 'Seed Selection & Treatment',
            badge: 'Events 2',
            summary: 'Day 0‚Äì1\nCondition: Seed tubers selected; healthy, disease-free',
            events: [
              'Select certified, disease-free seed tubers of desired variety.',
              'Treat tubers with fungicide or insecticide to prevent storage or soil-borne diseases.',
              'Pre-sprouting (chitting) if required: allow tubers to develop short sprouts before planting.'
            ]
          },
          {
            id: 'potato_planting',
            title: 'Planting / Sowing',
            badge: 'Events 3',
            summary: 'Day 1‚Äì5\nCondition: Seed tubers or sprouted tubers planted in prepared ridges/beds',
            events: [
              'Plant tubers at recommended spacing (e.g., 25‚Äì30 cm between tubers, 60‚Äì75 cm between rows).',
              'Plant at depth 8‚Äì10 cm (adjust depending on soil and variety).',
              'Irrigate immediately after planting to settle soil around tubers.'
            ]
          },
          {
            id: 'potato_veg',
            title: 'Vegetative Growth / Early Stage',
            badge: 'Events 4',
            summary: 'Day 6‚Äì30\nCondition: Sprouts emerging; young shoots; soil moist',
            events: [
              'Maintain consistent irrigation (avoid water stress).',
              'Apply basal fertilizers or split as per soil test.',
              'Monitor emergence and early growth; remove diseased sprouts.',
              'Weed control to reduce competition.'
            ]
          },
          {
            id: 'potato_tuber',
            title: 'Tuber Initiation Stage',
            badge: 'Events 5',
            summary: 'Day 31‚Äì50\nCondition: Plants actively growing; first tubers forming',
            events: [
              'Ensure adequate water supply; maintain soil moisture without waterlogging.',
              'Apply side-dress nitrogen if required.',
              'Hill up soil around plants to support tuber development.',
              'Monitor for late blight and manage accordingly.'
            ]
          },
          {
            id: 'potato_bulking',
            title: 'Tuber Bulking / Growth Stage',
            badge: 'Events 6',
            summary: 'Day 51‚Äì80\nCondition: Plants fully developed; tubers enlarging',
            events: [
              'Irrigate regularly and evenly to support rapid tuber growth.',
              'Apply potassium-rich fertilizer to promote tuber size and quality.',
              'Continue pest and disease management.'
            ]
          },
          {
            id: 'potato_maturation',
            title: 'Maturation / Pre-Harvest Stage',
            badge: 'Events 7',
            summary: 'Day 81‚Äì100\nCondition: Foliage starting to yellow and die back; tubers mature',
            events: [
              'Gradually reduce irrigation to allow foliage to die back and tubers to mature.',
              'Monitor tubers for size and quality.',
              'Stop fertilizer application; avoid excess water which may cause tuber rot.'
            ]
          },
          {
            id: 'potato_harvest',
            title: 'Harvesting',
            badge: 'Events 8',
            summary: 'Day 101‚Äì120\nCondition: Tubers mature, foliage dry',
            events: [
              'Harvest tubers carefully to avoid mechanical damage.',
              'Use appropriate tools (forks, spades) to lift tubers from soil.',
              'Collect tubers and sort by size/quality.'
            ]
          },
          {
            id: 'potato_post',
            title: 'Post-Harvest / Storage',
            badge: 'Events 9',
            summary: 'Immediately after harvest\nCondition: Tubers clean, free of disease, sorted',
            events: [
              'Cure tubers in a ventilated, dark place for a few days to toughen skin.',
              'Store in cool, dry, ventilated conditions; avoid light to prevent greening.',
              'Protect against pests and diseases.',
              'Remove field residues or compost for next crop cycle.'
            ]
          }
        ]
      },

      {
        id: 'corn',
        name: 'Corn',
        stages: [
          {
            id: 'corn_pre',
            title: 'Pre-sowing / Land Preparation',
            badge: 'Events 1',
            summary: '~1‚Äì2 weeks before sowing\nCondition: Field cleared of previous crop, leveled, soil tested and fertile',
            events: [
              'Remove crop residues and weeds.',
              'Plough 2‚Äì3 times to loosen soil and improve aeration.',
              'Level field for uniform irrigation.',
              'Conduct soil test: check pH, N/P/K, micronutrients; apply FYM/compost/lime as needed.',
              'Prepare irrigation/drainage system.'
            ]
          },
          {
            id: 'corn_seed',
            title: 'Seed Selection & Treatment',
            badge: 'Events 2',
            summary: 'Day 0\nCondition: Healthy, high-yielding seeds selected',
            events: [
              'Select certified, disease-free corn seeds of desired variety.',
              'Treat seeds with fungicide/insecticide if needed.',
              'Optional: pre-soak seeds for faster germination in some cases.'
            ]
          },
          {
            id: 'corn_planting',
            title: 'Sowing / Planting',
            badge: 'Events 3',
            summary: 'Day 1‚Äì3\nCondition: Soil prepared, moisture adequate',
            events: [
              'Plant seeds at recommended spacing (e.g., 20‚Äì25 cm between plants, 60‚Äì75 cm between rows).',
              'Plant at depth ~3‚Äì5 cm (adjust for soil type).',
              'Water immediately after sowing if soil moisture is low.'
            ]
          },
          {
            id: 'corn_germ',
            title: 'Germination / Seedling Stage',
            badge: 'Events 4',
            summary: 'Day 4‚Äì20\nCondition: Seeds sprouting; seedlings emerging',
            events: [
              'Maintain soil moisture for uniform emergence.',
              'Monitor seedling health; remove diseased or weak seedlings.',
              'Weed control at early stage to reduce competition.'
            ]
          },
          {
            id: 'corn_veg',
            title: 'Vegetative Growth / Tillering Stage',
            badge: 'Events 5',
            summary: 'Day 21‚Äì40\nCondition: Plants actively growing, multiple leaves',
            events: [
              'Continue irrigation as needed; avoid water stress.',
              'Apply first split of nitrogen fertilizer; apply P & K as per soil test.',
              'Weeding and soil aeration as necessary.'
            ]
          },
          {
            id: 'corn_tassel',
            title: 'Stem Elongation / Tasseling Initiation',
            badge: 'Events 6',
            summary: 'Day 41‚Äì60\nCondition: Plants taller; tassels emerging; soil moist',
            events: [
              'Apply additional nitrogen and micronutrients as required.',
              'Maintain consistent irrigation to avoid water stress.',
              'Continue pest/disease monitoring.'
            ]
          },
          {
            id: 'corn_flowering',
            title: 'Flowering / Silking & Pollination',
            badge: 'Events 7',
            summary: 'Day 61‚Äì75\nCondition: Tassels fully visible; silks emerging; high nutrient/water demand',
            events: [
              'Ensure adequate water supply for pollination and grain set.',
              'Apply potassium-rich fertilizer to improve grain filling.',
              'Scout intensively for pests (corn borer, aphids) and diseases.'
            ]
          },
          {
            id: 'corn_grain',
            title: 'Grain Filling / Maturation Stage',
            badge: 'Events 8',
            summary: 'Day 76‚Äì100\nCondition: Grains developing; moisture still important; plant approaching maturity',
            events: [
              'Continue irrigation until kernel hardening begins.',
              'Maintain nutrition if required, reduce nitrogen to avoid excess vegetative growth.',
              'Protect from pests and diseases.'
            ]
          },
          {
            id: 'corn_harvest',
            title: 'Harvesting',
            badge: 'Events 9',
            summary: 'Day 101‚Äì120\nCondition: Grains fully developed; moisture content reduced (~20‚Äì25%)',
            events: [
              'Harvest when grains reach proper moisture and maturity.',
              'Use appropriate methods (manual or mechanical) to minimize grain loss.',
              'Dry harvested cobs or grains to safe storage moisture (~12‚Äì14%).'
            ]
          },
          {
            id: 'corn_post',
            title: 'Post-Harvest / Storage',
            badge: 'Events 10',
            summary: 'Immediately after harvest\nCondition: Grains clean and dried',
            events: [
              'Clean grains, remove debris, sort for quality.',
              'Store in cool, ventilated storage; protect from pests (rodents, insects) and fungal contamination.'
            ]
          }
        ]
      },

      {
        id: 'onion',
        name: 'Onion',
        stages: [
          {
            id: 'onion_pre',
            title: 'Pre-sowing / Land Preparation',
            badge: 'Events 1',
            summary: '~1‚Äì2 weeks before sowing\nCondition: Land cleared of previous crop; leveled; soil fertile and tested',
            events: [
              'Remove crop residues and weeds.',
              'Plough/till 2‚Äì3 times to loosen soil.',
              'Level the field for uniform irrigation.',
              'Conduct soil test; apply FYM/compost/lime if needed.',
              'Prepare irrigation/drainage system.'
            ]
          },
          {
            id: 'onion_nursery',
            title: 'Seed Sowing / Nursery Stage',
            badge: 'Events 2',
            summary: 'Day 0‚Äì25\nCondition: Seeds germinating in trays/pots/nursery; soil moist',
            events: [
              'Select high-quality seeds.',
              'Sow in nursery beds or trays at recommended density.',
              'Maintain moisture with light irrigation; avoid waterlogging.',
              'Harden seedlings 5‚Äì7 days before transplanting.'
            ]
          },
          {
            id: 'onion_transplant',
            title: 'Transplanting / Establishment',
            badge: 'Events 3',
            summary: 'Day 26‚Äì35\nCondition: Seedlings 6‚Äì8 leaf stage; field prepared',
            events: [
              'Transplant at recommended spacing (e.g., 10‚Äì15 cm between plants, 20‚Äì25 cm between rows).',
              'Irrigate immediately.',
              'Apply starter fertilizer if required.'
            ]
          },
          {
            id: 'onion_veg',
            title: 'Vegetative Growth',
            badge: 'Events 4',
            summary: 'Day 36‚Äì70\nCondition: Active leaf growth; bulbs forming underground',
            events: [
              'Maintain irrigation; avoid water stress.',
              'Apply nitrogen fertilizer as split doses.',
              'Weed control.',
              'Pest/disease scouting: thrips, downy mildew.'
            ]
          },
          {
            id: 'onion_bulb',
            title: 'Bulb Formation / Maturation',
            badge: 'Events 5',
            summary: 'Day 71‚Äì110\nCondition: Bulbs enlarging; lower leaves yellowing',
            events: [
              'Reduce irrigation gradually to encourage bulb maturation.',
              'Monitor pests/diseases.',
              'Mulching if necessary to retain moisture.'
            ]
          },
          {
            id: 'onion_harvest',
            title: 'Harvesting',
            badge: 'Events 6',
            summary: 'Day 111‚Äì130\nCondition: Bulbs fully mature; tops dry',
            events: [
              'Harvest bulbs carefully to avoid damage.',
              'Cure in ventilated area to toughen skin.',
              'Store in cool, dry place.'
            ]
          }
        ]
      },

      {
        id: 'brinjal',
        name: 'Brinjal',
        stages: [
          {
            id: 'brinjal_pre',
            title: 'Pre-sowing / Land Preparation',
            badge: 'Events 1',
            summary: '~1 week before sowing\nCondition: Field cleared; fertile; leveled',
            events: [
              'Remove residues and weeds.',
              'Plough/till 2‚Äì3 times.',
              'Level field; check irrigation setup.',
              'Apply FYM/compost as needed.'
            ]
          },
          {
            id: 'brinjal_nursery',
            title: 'Seed Sowing / Nursery',
            badge: 'Events 2',
            summary: 'Day 0‚Äì25\nCondition: Seedlings in nursery trays/pots; soil moist',
            events: [
              'Sow high-quality seeds in nursery.',
              'Maintain moisture; avoid waterlogging.',
              'Harden seedlings 5‚Äì7 days before transplanting.'
            ]
          },
          {
            id: 'brinjal_transplant',
            title: 'Transplanting / Establishment',
            badge: 'Events 3',
            summary: 'Day 26‚Äì35\nCondition: Seedlings 4‚Äì6 leaf stage; field prepared',
            events: [
              'Transplant at spacing 50 cm √ó 50 cm (adjust by variety).',
              'Irrigate immediately after transplanting.',
              'Apply basal fertilizer as per soil test.'
            ]
          },
          {
            id: 'brinjal_veg',
            title: 'Vegetative Growth',
            badge: 'Events 4',
            summary: 'Day 36‚Äì60\nCondition: Plants growing actively; multiple branches',
            events: [
              'Maintain irrigation and drainage.',
              'Apply nitrogen fertilizer as split doses.',
              'Weeding and staking if needed.',
              'Pest/disease scouting: shoot & fruit borer'
            ]
          },
          {
            id: 'brinjal_flower',
            title: 'Flowering & Fruit Set',
            badge: 'Events 5',
            summary: 'Day 61‚Äì90\nCondition: Flowers opening; small fruits forming',
            events: [
              'Maintain irrigation for fruit set.',
              'Apply potassium-rich fertilizer to improve fruit quality.',
              'Monitor for pests/diseases; remove affected parts.'
            ]
          },
          {
            id: 'brinjal_maturation',
            title: 'Fruit Development / Maturation',
            badge: 'Events 6',
            summary: 'Day 91‚Äì120\nCondition: Fruits enlarging, reaching market size',
            events: [
              'Continue irrigation and nutrient application.',
              'Harvest mature fruits at intervals to prevent over-ripening.',
              'Remove diseased or damaged fruits.'
            ]
          }
        ]
      },

      {
        id: 'chili',
        name: 'Chili',
        stages: [
          {
            id: 'chili_pre',
            title: 'Pre-sowing / Land Preparation',
            badge: 'Events 1',
            summary: '~1‚Äì2 weeks before sowing\nCondition: Land cleared, fertile, leveled',
            events: [
              'Remove residues and weeds.',
              'Plough 2‚Äì3 times; level soil.',
              'Apply compost/FYM; prepare irrigation.'
            ]
          },
          {
            id: 'chili_nursery',
            title: 'Seed Sowing / Nursery',
            badge: 'Events 2',
            summary: 'Day 0‚Äì30\nCondition: Seeds germinating in nursery beds/trays; soil moist',
            events: [
              'Sow seeds in nursery trays/pots.',
              'Maintain soil moisture; avoid waterlogging.',
              'Harden seedlings before transplanting.'
            ]
          },
          {
            id: 'chili_transplant',
            title: 'Transplanting / Establishment',
            badge: 'Events 3',
            summary: 'Day 31‚Äì40\nCondition: Seedlings 6‚Äì8 leaf stage; field prepared',
            events: [
              'Transplant at recommended spacing (e.g., 45‚Äì60 cm between rows, 30‚Äì45 cm between plants).',
              'Irrigate immediately.',
              'Apply basal fertilizers as per soil test.'
            ]
          },
          {
            id: 'chili_veg',
            title: 'Vegetative Growth',
            badge: 'Events 4',
            summary: 'Day 41‚Äì70\nCondition: Plants actively growing; multiple branches',
            events: [
              'Maintain irrigation; avoid water stress.',
              'Side-dress nitrogen as needed.',
              'Weed control.',
              'Pest/disease monitoring: aphids, mites, leaf spot.'
            ]
          },
          {
            id: 'chili_flower',
            title: 'Flowering & Fruit Set',
            badge: 'Events 5',
            summary: 'Day 71‚Äì100\nCondition: Flowers visible; fruits forming',
            events: [
              'Ensure irrigation for pollination and fruit set.',
              'Apply potassium & phosphorus for fruit quality.',
              'Support plants if necessary.',
              'Continue pest/disease control.'
            ]
          },
          {
            id: 'chili_maturation',
            title: 'Fruit Development / Maturation',
            badge: 'Events 6',
            summary: 'Day 101‚Äì130\nCondition: Fruits enlarging, ripening',
            events: [
              'Harvest mature fruits at intervals.',
              'Protect fruits from pests and sunscald.',
              'Continue monitoring for diseases.'
            ]
          }
        ]
      },

      {
        id: 'carrot',
        name: 'Carrot',
        stages: [
          {
            id: 'carrot_pre',
            title: 'Pre-sowing / Land Preparation',
            badge: 'Events 1',
            summary: '~1 week before sowing\nCondition: Field cleared, loose, fertile, leveled',
            events: [
              'Remove residues and weeds.',
              'Deep plough to loosen soil (avoid stones).',
              'Level field for uniform irrigation.',
              'Apply FYM/compost and other soil amendments.'
            ]
          },
          {
            id: 'carrot_sow',
            title: 'Seed Sowing',
            badge: 'Events 2',
            summary: 'Day 0‚Äì7\nCondition: Seeds sown in fine, loose seedbed',
            events: [
              'Sow seeds directly in rows at recommended spacing (2‚Äì5 cm between plants, 30 cm between rows).',
              'Cover lightly with soil.',
              'Maintain soil moisture for germination.'
            ]
          },
          {
            id: 'carrot_germ',
            title: 'Germination / Seedling Stage',
            badge: 'Events 3',
            summary: 'Day 8‚Äì25\nCondition: Seedlings emerging; soil moist',
            events: [
              'Maintain soil moisture with light irrigation.',
              'Thin seedlings to proper spacing.',
              'Weed control.'
            ]
          },
          {
            id: 'carrot_root',
            title: 'Vegetative / Root Development',
            badge: 'Events 4',
            summary: 'Day 26‚Äì50\nCondition: Plants actively growing; roots elongating',
            events: [
              'Continue regular irrigation; avoid water stress.',
              'Side-dress nitrogen as needed.',
              'Weeding and earthing-up if necessary.'
            ]
          },
          {
            id: 'carrot_maturation',
            title: 'Root Maturation / Pre-Harvest',
            badge: 'Events 5',
            summary: 'Day 51‚Äì70\nCondition: Roots approaching marketable size; leaves healthy',
            events: [
              'Reduce irrigation gradually before harvest.',
              'Remove diseased leaves; continue pest monitoring.'
            ]
          },
          {
            id: 'carrot_harvest',
            title: 'Harvesting',
            badge: 'Events 6',
            summary: 'Day 71‚Äì90\nCondition: Roots fully developed; leaves yellowing/slightly dry',
            events: [
              'Harvest carefully to avoid root damage.',
              'Wash, grade, and dry if needed.',
              'Store in cool, ventilated place.'
            ]
          }
        ]
      }
    ]; // end CROPS

    // ---------- rendering + behaviour (keeps your theme) ----------
    const accordionRoot = document.getElementById('accordionRoot');
    const cropSelect = document.getElementById('cropSelect');
    const showAllBtn = document.getElementById('showAllBtn');

    function escapeHtml(str = '') {
      return String(str)
        .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
        .replaceAll('"','&quot;').replaceAll("'",'&#39;');
    }

    function renderCropOptions() {
      cropSelect.innerHTML = '';
      // placeholder
      const placeholder = document.createElement('option');
      placeholder.value = '';
      placeholder.textContent = '‚Äî Select crop ‚Äî';
      placeholder.selected = true;
      cropSelect.appendChild(placeholder);

      CROPS.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.id;
        opt.textContent = c.name;
        cropSelect.appendChild(opt);
      });
    }

    function renderAccordion() {
      accordionRoot.innerHTML = '';
      CROPS.forEach(crop => {
        const cropCard = document.createElement('div');
        cropCard.className = 'bg-white rounded-xl p-6 shadow-lg';
        cropCard.id = `crop-${crop.id}`;

        cropCard.innerHTML = `
          <div class="flex items-center gap-4 mb-4">
            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600 font-bold">üåæ</div>
            <div class="flex-1">
              <div class="text-xl font-semibold text-gray-800">${escapeHtml(crop.name)} Calendar</div>
              <div class="text-sm text-gray-500">Events</div>
            </div>
          </div>
        `;

        const stagesWrapper = document.createElement('div');
        stagesWrapper.className = 'space-y-4';

        crop.stages.forEach(stage => {
          const stageOuter = document.createElement('div');
          stageOuter.className = 'bg-gray-100 rounded-lg p-3';

          const header = document.createElement('div');
          header.className = 'flex items-center justify-between gap-4 stage-header';
          header.tabIndex = 0;
          header.setAttribute('role','button');
          header.setAttribute('aria-expanded','false');

          header.innerHTML = `
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 rounded-full bg-white border flex items-center justify-center text-green-600">
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2v20"/><path d="M2 12h20"/></svg>
              </div>
              <div>
                <div class="text-lg font-semibold text-gray-800">${escapeHtml(stage.title)}</div>
                <div class="text-xs text-green-600 mt-1">${escapeHtml(stage.badge || '')}</div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button class="w-10 h-10 rounded-full bg-white border flex items-center justify-center text-gray-600">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
              </button>
            </div>
          `;

          const content = document.createElement('div');
          content.className = 'collapsible px-4 pt-4';
          content.style.maxHeight = '0px';
          content.style.paddingBottom = '0px';
          content.dataset.open = 'false';

          const inner = document.createElement('div');
          inner.className = 'bg-white rounded-md p-4 border border-gray-200';
          inner.innerHTML = `
            <div class="text-sm text-gray-700 mb-3">${escapeHtml(stage.summary).replace(/\n/g,'<br/>')}</div>
            <div class="text-sm font-semibold text-gray-800 mb-2">Events</div>
            <ul class="list-inside space-y-2 text-gray-700">
              ${stage.events.map(ev => `<li class="flex gap-2 items-start"><svg class="w-4 h-4 mt-1 text-green-500" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20 6L9 17l-5-5" stroke-width="2"/></svg><span>${escapeHtml(ev)}</span></li>`).join('')}
            </ul>
          `;

          content.appendChild(inner);

          const toggle = () => {
            const isOpen = content.dataset.open === 'true';
            if (isOpen) {
              content.style.maxHeight = '0px';
              content.style.paddingBottom = '0px';
              content.dataset.open = 'false';
              header.setAttribute('aria-expanded','false');
              stageOuter.classList.remove('outline-green');
            } else {
              const siblings = stageOuter.parentElement.querySelectorAll('.collapsible');
              siblings.forEach(sib => {
                if (sib !== content) {
                  sib.style.maxHeight = '0px';
                  sib.style.paddingBottom = '0px';
                  sib.dataset.open = 'false';
                  if (sib.previousElementSibling) sib.previousElementSibling.setAttribute('aria-expanded','false');
                  if (sib.parentElement) sib.parentElement.classList.remove('outline-green');
                }
              });
              content.style.maxHeight = inner.scrollHeight + 24 + 'px';
              content.style.paddingBottom = '12px';
              content.dataset.open = 'true';
              header.setAttribute('aria-expanded','true');
              stageOuter.classList.add('outline-green');
            }
          };

          header.addEventListener('click', toggle);
          header.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              toggle();
            }
          });

          stageOuter.appendChild(header);
          stageOuter.appendChild(content);
          stagesWrapper.appendChild(stageOuter);
        });

        cropCard.appendChild(stagesWrapper);
        accordionRoot.appendChild(cropCard);
      });
    }

    // Initialize UI
    renderCropOptions();
    renderAccordion();

    // --- NEW: on load hide all crop cards by default ---
    function hideAllCropCards() {
      CROPS.forEach(c => {
        const el = document.getElementById('crop-' + c.id);
        if (el) el.style.display = 'none';
      });
    }
    // Hide all immediately so page shows none until user acts
    hideAllCropCards();

    // Show all crops (for Show all button)
    function showAllCrops() {
      CROPS.forEach(c => {
        const el = document.getElementById('crop-' + c.id);
        if (el) el.style.display = '';
      });
      // reset select to placeholder
      cropSelect.value = '';
    }

    // Show only selected crop
    function showOnlyCrop(cropId) {
      CROPS.forEach(c => {
        const el = document.getElementById('crop-' + c.id);
        if (!el) return;
        if (c.id === cropId) {
          el.style.display = '';
          setTimeout(()=> el.scrollIntoView({ behavior:'smooth', block:'start' }), 80);
        } else {
          el.style.display = 'none';
        }
      });
    }

    // Hook select to show only crop (or hide all if placeholder)
    cropSelect.addEventListener('change', (e) => {
      const selectedId = e.target.value;
      if (!selectedId) {
        // placeholder chosen -> hide all
        hideAllCropCards();
      } else {
        showOnlyCrop(selectedId);
      }
    });

    // Show all button
    showAllBtn.addEventListener('click', () => {
      showAllCrops();
    });

    // Expose functions if you want to call from other parts
    window.showOnlyCrop = showOnlyCrop;
    window.showAllCrops = showAllCrops;
    window.hideAllCropCards = hideAllCropCards;
  </script>
</body>
</html>
